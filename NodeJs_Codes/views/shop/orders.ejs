<%- include('../includes/head.ejs') %>
<link rel="stylesheet" href="/css/orders.css">
<link rel="stylesheet" href="/css/error-messages.css">
</head>

<body>
    <%- include('../includes/navigation.ejs') %>
    <main>
        <!-- Flash Messages -->
        <% const errorMessage = locals.errorMessage; %>
        <% const successMessage = locals.successMessage; %>
        <% if (errorMessage && errorMessage.length > 0) { %>
            <div class="error-message show">
                <span><%= errorMessage[0] %></span>
                <button class="close-btn" onclick="this.parentElement.style.display='none'">&times;</button>
            </div>
        <% } %>
        <% if (successMessage && successMessage.length > 0) { %>
            <div class="success-message show">
                <span><%= successMessage[0] %></span>
                <button class="close-btn" onclick="this.parentElement.style.display='none'">&times;</button>
            </div>
        <% } %>
        <% if (orders.length <= 0) { %>
            <h1>Nothing there!</h1>
        <% } else { %>
            <% orders.forEach(order => { %>
                <div class="order-card">
                    <div class="order-header">
                        <h2>üõçÔ∏è Order #<%= order._id.toString().slice(-8) %></h2>
                        <div class="order-meta">
                            <span class="order-date">üìÖ <%= new Date(order.orderDate).toLocaleDateString() %></span>
                            <span class="order-status status-<%= order.status || 'pending' %>">
                                <% if (order.status === 'pending') { %>‚è≥ Pending
                                <% } else if (order.status === 'confirmed') { %>‚úÖ Confirmed
                                <% } else if (order.status === 'shipped') { %>üöö Shipped
                                <% } else if (order.status === 'delivered') { %>üì¶ Delivered
                                <% } else { %>‚è≥ Processing<% } %>
                            </span>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="order-items">
                        <% order.items.forEach(item => { %>
                        <div class="order-item">
                            <img src="/<%= item.product.imageUrl %>" alt="<%= item.product.title %>" class="item-image">
                            <div class="item-details">
                                <h3><%= item.product.title %></h3>
                                <p class="item-price">$<%= item.product.price %> √ó <%= item.quantity %></p>
                                <p class="item-total">Total: $<%= (item.product.price * item.quantity).toFixed(2) %></p>
                            </div>
                        </div>
                        <% }); %>
                    </div>

                    <!-- Shipping Information (if available) -->
                    <% if (order.shippingAddress) { %>
                    <div class="shipping-info">
                        <h4>üöö Shipping Address:</h4>
                        <p><strong><%= order.shippingAddress.fullName %></strong></p>
                        <p><%= order.shippingAddress.address %></p>
                        <p><%= order.shippingAddress.city %>, <%= order.shippingAddress.postalCode %></p>
                        <p><%= order.shippingAddress.country %></p>
                    </div>
                    <% } %>

                    <!-- Payment Method (if available) -->
                    <% if (order.paymentMethod) { %>
                    <div class="payment-info">
                        <h4>üí≥ Payment Method:</h4>
                        <p>
                            <% if (order.paymentMethod === 'cash_on_delivery') { %>üíµ Cash on Delivery
                            <% } else if (order.paymentMethod === 'credit_card') { %>üí≥ Credit Card
                            <% } else if (order.paymentMethod === 'debit_card') { %>üí≥ Debit Card
                            <% } else { %><%= order.paymentMethod %><% } %>
                        </p>
                    </div>
                    <% } %>

                    <!-- Order Total -->
                    <div class="order-total">
                        <% if (order.totalAmount) { %>
                            <h3>Total: $<%= order.totalAmount.toFixed(2) %></h3>
                        <% } else { %>
                            <h3>Total: $<%= order.items.reduce((total, item) => total + (item.product.price * item.quantity), 0).toFixed(2) %></h3>
                        <% } %>
                    </div>

                    <div class="order-actions">
                        <a href="/orders/<%= order._id %>" class="btn invoice-btn">üìÑ View Invoice</a>
                    </div>
                </div>
                <% }); %>

        <% } %>
    </main>
<%- include('../includes/end.ejs') %>
